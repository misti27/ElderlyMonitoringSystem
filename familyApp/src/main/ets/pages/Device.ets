import { FamilyStore } from '../models/FamilyStore';

@Component
export default struct Device {
  @Consume('familyStore') store: FamilyStore;

  build() {
    Column() {
      // 1. é¡¶éƒ¨è®¾å¤‡çŠ¶æ€å¡ç‰‡
      this.buildDeviceHeader()

      Scroll() {
        Column({ space: 16 }) {
          // 2. æ ¸å¿ƒçŠ¶æ€é¢æ¿
          this.buildStatusPanel()

          // 3. è®¾å¤‡å‚æ•°è®¾ç½®ç»„
          this.buildSettingsGroup()

          // 4. å±é™©æ“ä½œåŒº
          Button('è§£é™¤è®¾å¤‡ç»‘å®š')
            .width('100%')
            .height(50)
            .backgroundColor('#fff1f0')
            .fontColor('#ff4d4f')
            .borderRadius(12)
            .margin({ top: 20, bottom: 40 })
            .onClick(() => {
              // å¤„ç†è§£ç»‘é€»è¾‘
            })
        }
        .padding(16)
      }
      .layoutWeight(1)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f5f7fa')
  }

  // é¡¶éƒ¨å¤§å¡ç‰‡ï¼šå±•ç¤ºè®¾å¤‡åž‹å·å’Œå®žæ—¶è¿žæŽ¥çŠ¶æ€
  @Builder
  buildDeviceHeader() {
    Column() {
      Row() {
        // è®¾å¤‡å›¾æ ‡
        Stack() {
          Circle({ width: 70, height: 70 }).fill('#ffffff').opacity(0.2)
          Text('ðŸ“±').fontSize(40)
        }
        .margin({ right: 20 })

        Column() {
          Text('è€å¹´äººå¥åº·ç›‘æµ‹')
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .fontColor('#ffffff')

          Row() {
            // çŠ¶æ€æŒ‡ç¤ºç¯
            Circle({ width: 8, height: 8 })
              .fill('#52c41a')
              .margin({ right: 6 })
            Text('å·²è¿žæŽ¥')
              .fontSize(14)
              .fontColor('#ffffff')
              .opacity(0.9)
          }
          .margin({ top: 8 })
        }
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .padding({ left: 24, right: 24, top: 40, bottom: 40 })
    }
    .width('100%')
    .backgroundColor('#1890ff')
  }

  // çŠ¶æ€é¢æ¿ï¼šå±•ç¤ºç”µé‡ã€åºåˆ—å·ç­‰
  @Builder
  buildStatusPanel() {
    Row() {
      this.buildStatusItem('å‰©ä½™ç”µé‡', `${this.store.elderlyStatus?.batteryLevel ?? 0}%`, '#52c41a')
      Divider().vertical(true).height(30).color('#eee')
      this.buildStatusItem('ä¿¡å·å¼ºåº¦', 'æžå¼º', '#1890ff')
      Divider().vertical(true).height(30).color('#eee')
      this.buildStatusItem('å›ºä»¶ç‰ˆæœ¬', 'v1.2.4', '#999')
    }
    .width('100%')
    .padding(20)
    .backgroundColor('#ffffff')
    .borderRadius(16)
    .justifyContent(FlexAlign.SpaceAround)
    .shadow({ radius: 10, color: '#10000000', offsetX: 0, offsetY: 5 })
  }

  @Builder
  buildStatusItem(label: string, value: string, color: string) {
    Column() {
      Text(label).fontSize(12).fontColor('#999').margin({ bottom: 4 })
      Text(value).fontSize(16).fontWeight(FontWeight.Bold).fontColor(color)
    }
  }

  // è®¾ç½®ç»„ï¼šæŠ¥è­¦é˜ˆå€¼ç­‰é…ç½®
  @Builder
  buildSettingsGroup() {
    Column() {
      Text('è®¾å¤‡é…ç½®')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 12, left: 4 })
        .alignSelf(ItemAlign.Start)

      Column() {
        this.buildMenuRow('å¿ƒçŽ‡æŠ¥è­¦ä¸Šé™', '120 bpm')
        this.buildMenuRow('é‡‡æ ·é¢‘çŽ‡', 'æ¯10ç§’ä¸€æ¬¡')
        this.buildMenuRow('è·Œå€’æ£€æµ‹çµæ•åº¦', 'ä¸­ç­‰')
        this.buildMenuRow('ä½©æˆ´æ£€æµ‹', 'å·²å¼€å¯', false)
      }
      .backgroundColor('#ffffff')
      .borderRadius(16)
    }
    .width('100%')
  }

  @Builder
  buildMenuRow(title: string, value: string, hasDivider: boolean = true) {
    Column() {
      Row() {
        Text(title).fontSize(15).fontColor('#333')
        Blank()
        Text(value).fontSize(14).fontColor('#999').margin({ right: 8 })
        Text('>').fontSize(14).fontColor('#ccc')
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })

      if (hasDivider) {
        Divider().color('#f5f5f5').margin({ left: 16, right: 16 })
      }
    }
  }
}